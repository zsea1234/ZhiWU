{
  "openapi": "3.0.0",
  "info": {
    "title": "智能房屋租赁系统 API",
    "version": "1.0.1",
    "description": "基于Flask框架的智能房屋租赁系统API文档。该文档详细定义了系统所有核心功能的API接口，用于前后端交互，包括用户认证、房源管理、智能搜索、消息通讯、租赁流程、维修与投诉、报表统计以及系统管理等模块。严格按照PDF需求文档进行设计。",
    "contact": {
      "name": "API Support",
      "email": "support@example.com"
    }
  },
  "servers": [
    {
      "url": "http://localhost:5000/api/v1",
      "description": "本地开发服务器"
    },
    {
      "url": "https://api.yourdomain.com/v1",
      "description": "生产环境服务器"
    }
  ],
  "tags": [
    { "name": "Authentication", "description": "用户认证接口，包括注册、登录、登出及多因素认证（MFA）。" },
    { "name": "Users", "description": "用户个人资料管理接口，包括查看和更新当前用户信息。" },
    { "name": "Properties", "description": "房源管理接口，包括房源的发布、搜索、查看详情、更新和删除，以及图片视频管理。" },
    { "name": "Bookings", "description": "看房预约管理接口，包括租客预约、房东确认/取消、租客取消等。" },
    { "name": "Leases", "description": "租赁合同管理接口，包括在线创建、签署、查看和管理租赁合同。" },
    { "name": "Payments", "description": "租金支付管理接口，包括租客支付租金和查看支付记录。" },
    { "name": "Messages", "description": "用户间消息通讯接口，支持文本消息和智能代理初步应答。" },
    { "name": "News", "description": "租赁相关新闻资讯管理接口，房东可发布、修改和删除新闻。" },
    { "name": "Maintenance", "description": "维修申请管理接口，租客提交申请，房东或物业处理。" },
    { "name": "Complaints", "description": "投诉管理接口，租客提交投诉，系统管理员处理。" },
    { "name": "Admin - Users", "description": "【管理员】用户管理接口，包括查看、更新和删除系统用户。" },
    { "name": "Admin - Properties", "description": "【管理员】房源管理接口，包括审核和管理所有房源。" },
    { "name": "Admin - Reports", "description": "【管理员】系统报表与统计接口，提供出租率、收入等报表。" },
    { "name": "Admin - System", "description": "【管理员】系统监控与日志管理接口。" }
  ],
  "paths": {
    "/auth/register": {
      "post": {
        "tags": ["Authentication"],
        "summary": "用户注册",
        "description": "允许新用户（房东或租客）注册账户。系统管理员账户通常预置或通过其他安全途径创建。",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UserRegistrationInput" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "用户注册成功。根据系统配置，可能需要MFA设置或直接返回用户信息和认证Token。",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/AuthResponse" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "409": { "$ref": "#/components/responses/Conflict" }
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": ["Authentication"],
        "summary": "用户登录",
        "description": "用户（房东、租客、管理员）使用凭证登录系统。支持多因素身份验证。",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/LoginInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "登录成功。如果MFA未启用或已验证，返回认证Token和用户信息。如果需要MFA，则提示进行MFA验证。",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/AuthResponse" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" }
        }
      }
    },
    "/auth/mfa/setup": {
      "post": {
        "tags": ["Authentication"],
        "summary": "设置多因素认证 (MFA)",
        "description": "用户在首次启用MFA或重置MFA时调用此接口获取MFA设置信息（如TOTP密钥和二维码）。",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功获取MFA设置信息。",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MFASetupResponse" }
              }
            }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" }
        }
      }
    },
    "/auth/mfa/verify": {
      "post": {
        "tags": ["Authentication"],
        "summary": "验证多因素认证 (MFA) 代码",
        "description": "用户在登录或执行敏感操作时，提交MFA动态验证码进行验证。",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/MFAVerifyInput" }
            }
          }
        },
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "MFA验证成功。如果是登录流程中的MFA，则返回完整的认证Token和用户信息。",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/AuthResponse" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": ["Authentication"],
        "summary": "用户登出",
        "description": "用户登出系统，使其认证Token失效。",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "204": { "description": "登出成功。" },
          "401": { "$ref": "#/components/responses/Unauthorized" }
        }
      }
    },
    "/users/me": {
      "get": {
        "tags": ["Users"],
        "summary": "获取当前用户信息",
        "description": "获取当前已登录用户的详细个人信息，包括租赁历史等。",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "成功获取当前用户信息。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserOutput" } } }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" }
        }
      },
      "put": {
        "tags": ["Users"],
        "summary": "更新当前用户信息",
        "description": "允许当前已登录用户更新其个人信息，如联系方式、密码等。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserUpdateInput" } } }
        },
        "responses": {
          "200": {
            "description": "用户信息更新成功。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserOutput" } } }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" }
        }
      }
    },
    "/properties": {
      "post": {
        "tags": ["Properties"],
        "summary": "房东发布新房源",
        "description": "房东用户可以发布新的房源信息，包括详细描述、价格、图片和视频等。需要房东权限。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": { "$ref": "#/components/schemas/PropertyCreateInput" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "房源发布成功。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PropertyOutput" } } }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" }
        }
      },
      "get": {
        "tags": ["Properties"],
        "summary": "搜索/查询房源列表",
        "description": "公开接口，允许任何人按多种条件（地区、户型、租金范围等）搜索房源。列表显示房源摘要信息和符合条件的总数。支持分页。后端可根据查询参数实现“智能推荐”逻辑进行排序或筛选。",
        "parameters": [
          { "name": "keyword", "in": "query", "description": "关键词搜索（地址、小区名等）", "schema": { "type": "string" } },
          { "name": "area_code", "in": "query", "description": "区域代码（如行政区划代码）", "schema": { "type": "string" } },
          { "name": "property_type", "in": "query", "description": "房屋类型 (参考 PropertyType enum)", "schema": { "type": "string" } },
          { "name": "bedrooms", "in": "query", "description": "卧室数量", "schema": { "type": "integer", "minimum": 0 } },
          { "name": "living_rooms", "in": "query", "description": "客厅数量", "schema": { "type": "integer", "minimum": 0 } },
          { "name": "min_rent", "in": "query", "description": "最低月租金", "schema": { "type": "number", "format": "float", "minimum": 0 } },
          { "name": "max_rent", "in": "query", "description": "最高月租金", "schema": { "type": "number", "format": "float", "minimum": 0 } },
          { "name": "min_area", "in": "query", "description": "最小面积 (平方米)", "schema": { "type": "number", "format": "float", "minimum": 0 } },
          { "name": "max_area", "in": "query", "description": "最大面积 (平方米)", "schema": { "type": "number", "format": "float", "minimum": 0 } },
          { "name": "status", "in": "query", "description": "房源状态 (通常搜索空置房源)", "schema": { "$ref": "#/components/schemas/PropertyStatus" } },
          { "name": "sort_by", "in": "query", "description": "排序字段 (e.g., 'rent_price', 'created_at')", "schema": { "type": "string" } },
          { "name": "sort_order", "in": "query", "description": "排序顺序 ('asc' 或 'desc')", "schema": { "type": "string", "enum": ["asc", "desc"], "default": "desc" } },
          { "name": "page", "in": "query", "description": "页码", "schema": { "type": "integer", "default": 1, "minimum": 1 } },
          { "name": "page_size", "in": "query", "description": "每页数量", "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 100 } }
        ],
        "responses": {
          "200": {
            "description": "成功获取房源列表。",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PaginatedPropertySummaryOutput" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" }
        }
      }
    },
    "/properties/{propertyId}": {
      "get": {
        "tags": ["Properties"],
        "summary": "获取房源详细信息",
        "description": "公开接口，获取指定ID房源的完整详细信息，包括所有图片、视频、详细描述、周边环境等。",
        "parameters": [
          { "name": "propertyId", "in": "path", "required": true, "description": "房源的唯一ID", "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "成功获取房源详情。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PropertyOutput" } } }
          },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      },
      "put": {
        "tags": ["Properties"],
        "summary": "房东更新房源信息",
        "description": "允许房东更新其发布的房源信息。只有房源的所属房东才能操作。需要房东权限。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "propertyId", "in": "path", "required": true, "description": "房源的唯一ID", "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
             "multipart/form-data": {  // 使用 multipart 以便同时更新文本和文件
              "schema": { "$ref": "#/components/schemas/PropertyUpdateInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "房源信息更新成功。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PropertyOutput" } } }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      },
      "delete": {
        "tags": ["Properties"],
        "summary": "房东删除房源信息",
        "description": "允许房东删除其发布的房源信息。只有房源的所属房东才能操作。需要房东权限。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "propertyId", "in": "path", "required": true, "description": "房源的唯一ID", "schema": { "type": "integer" } }
        ],
        "responses": {
          "204": { "description": "房源删除成功。" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      }
    },
    "/properties/{propertyId}/images": {
        "post": {
            "tags": ["Properties"],
            "summary": "为房源上传新的图片/视频",
            "description": "房东为其指定的房源上传一张或多张图片/视频。需要房东权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                {"name": "propertyId", "in": "path", "required": true, "description": "房源的唯一ID", "schema": {"type": "integer"}}
            ],
            "requestBody": {
                "required": true,
                "content": {
                    "multipart/form-data": {
                        "schema": {
                            "type": "object",
                            "properties": {
                                "files": {
                                    "type": "array",
                                    "items": { "type": "string", "format": "binary" },
                                    "description": "一个或多个图片/视频文件"
                                }
                            },
                            "required": ["files"]
                        }
                    }
                }
            },
            "responses": {
                "201": {
                    "description": "文件上传成功，返回新上传的媒体信息列表。",
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "array",
                                "items": { "$ref": "#/components/schemas/PropertyMediaOutput" }
                            }
                        }
                    }
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/properties/{propertyId}/images/{imageId}": {
        "delete": {
            "tags": ["Properties"],
            "summary": "删除房源的指定图片/视频",
            "description": "房东删除其房源下的特定图片或视频。需要房东权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                {"name": "propertyId", "in": "path", "required": true, "description": "房源的唯一ID", "schema": {"type": "integer"}},
                {"name": "imageId", "in": "path", "required": true, "description": "图片/视频的唯一ID", "schema": {"type": "integer"}}
            ],
            "responses": {
                "204": {"description": "图片/视频删除成功。"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/properties/{propertyId}/status": {
      "put": {
        "tags": ["Properties"],
        "summary": "房东更新房源状态",
        "description": "允许房东更新其房源的状态（如：空置、出租中、维修中）。需要房东权限。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "propertyId", "in": "path", "required": true, "description": "房源的唯一ID", "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/PropertyStatusUpdateInput" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "房源状态更新成功。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PropertyOutput" } } }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      }
    },
    "/bookings": {
      "post": {
        "tags": ["Bookings"],
        "summary": "租客在线预约看房",
        "description": "租客选择房源和期望时间，提交看房预约。需要租客权限。",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/BookingCreateInput" } } }
        },
        "responses": {
          "201": {
            "description": "看房预约请求已成功提交，等待房东确认。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/BookingOutput" } } }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "404": { "$ref": "#/components/responses/NotFound" , "description": "指定的房源不存在或不可预约"}
        }
      },
      "get": {
        "tags": ["Bookings"],
        "summary": "获取预约列表 (房东/租客)",
        "description": "房东获取其名下房源的预约列表，租客获取自己发起的预约列表。根据用户角色自动筛选。需要认证。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
            { "name": "property_id", "in": "query", "description": "房东按房源ID筛选", "schema": { "type": "integer" } },
            { "name": "status", "in": "query", "description": "按预约状态筛选", "schema": { "$ref": "#/components/schemas/BookingStatus" } },
            { "name": "page", "in": "query", "description": "页码", "schema": { "type": "integer", "default": 1, "minimum": 1 } },
            { "name": "page_size", "in": "query", "description": "每页数量", "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 100 } }
        ],
        "responses": {
          "200": {
            "description": "成功获取预约列表。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaginatedBookingOutput" } } }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" }
        }
      }
    },
    "/bookings/{bookingId}": {
      "get": {
        "tags": ["Bookings"],
        "summary": "获取指定预约详情",
        "description": "获取特定预约的详细信息。房东或相关租客可访问。需要认证。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "bookingId", "in": "path", "required": true, "description": "预约的唯一ID", "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "成功获取预约详情。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/BookingOutput" } } }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      },
      "put": {
        "tags": ["Bookings"],
        "summary": "更新预约状态 (房东确认/取消，租客取消)",
        "description": "房东可以确认或取消预约。租客可以在特定条件下取消自己发起的预约。需要相应权限。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "bookingId", "in": "path", "required": true, "description": "预约的唯一ID", "schema": { "type": "integer" } }
        ],
        "requestBody": {
            "required": true,
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/BookingStatusUpdateInput" } } }
        },
        "responses": {
          "200": {
            "description": "预约状态更新成功。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/BookingOutput" } } }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "404": { "$ref": "#/components/responses/NotFound" }
        }
      }
    },
    "/leases": {
        "post": {
            "tags": ["Leases"],
            "summary": "创建租赁合同 (在线签约发起)",
            "description": "房东或租客发起在线签约流程，创建一份待签署的租赁合同。需要认证。",
            "security": [{"bearerAuth": []}],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LeaseCreateInput" } } }
            },
            "responses": {
                "201": {
                    "description": "租赁合同创建成功，等待双方签署。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LeaseOutput" } } }
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound", "description": "关联的房源或用户不存在"}
            }
        },
        "get": {
            "tags": ["Leases"],
            "summary": "获取租赁合同列表 (房东/租客/管理员)",
            "description": "根据用户角色（房东、租客、管理员）获取相关的租赁合同列表。需要认证。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                { "name": "property_id", "in": "query", "description": "按房源ID筛选 (房东/管理员)", "schema": { "type": "integer" } },
                { "name": "tenant_id", "in": "query", "description": "按租客ID筛选 (房东/管理员)", "schema": { "type": "integer" } },
                { "name": "status", "in": "query", "description": "按合同状态筛选", "schema": { "$ref": "#/components/schemas/LeaseStatus" } },
                { "name": "page", "in": "query", "description": "页码", "schema": { "type": "integer", "default": 1, "minimum": 1 } },
                { "name": "page_size", "in": "query", "description": "每页数量", "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 100 } }
            ],
            "responses": {
                "200": {
                    "description": "成功获取租赁合同列表。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaginatedLeaseOutput" }}}
                },
                "401": {"$ref": "#/components/responses/Unauthorized"}
            }
        }
    },
    "/leases/{leaseId}": {
        "get": {
            "tags": ["Leases"],
            "summary": "获取指定租赁合同详情",
            "description": "获取特定租赁合同的详细信息。相关方（房东、租客）或管理员可访问。需要认证。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                {"name": "leaseId", "in": "path", "required": true, "description": "租赁合同的唯一ID", "schema": {"type": "integer"}}
            ],
            "responses": {
                "200": {
                    "description": "成功获取租赁合同详情。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LeaseOutput" }}}
                },
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        },
        "put": {
            "tags": ["Leases"],
            "summary": "更新租赁合同 (如签署、修改状态)",
            "description": "用于合同签署（房东或租客确认签署）或管理员修改合同状态等。需要相应权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                {"name": "leaseId", "in": "path", "required": true, "description": "租赁合同的唯一ID", "schema": {"type": "integer"}}
            ],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LeaseUpdateInput" } } }
            },
            "responses": {
                "200": {
                    "description": "租赁合同更新成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LeaseOutput" }}}
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/leases/{leaseId}/sign": {
        "post": {
            "tags": ["Leases"],
            "summary": "签署租赁合同",
            "description": "房东或租客对指定的待签署合同进行电子签署确认。需要认证。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                {"name": "leaseId", "in": "path", "required": true, "description": "租赁合同的唯一ID", "schema": {"type": "integer"}}
            ],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LeaseSignInput" } } }
            },
            "responses": {
                "200": {
                    "description": "合同签署成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LeaseOutput" }}}
                },
                "400": {"$ref": "#/components/responses/BadRequest", "description": "例如合同状态不正确或非签署方"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/payments/leases/{leaseId}": {
        "post": {
            "tags": ["Payments"],
            "summary": "租客为指定合同在线支付租金",
            "description": "租客为当前有效的租赁合同支付租金。需要租客权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                {"name": "leaseId", "in": "path", "required": true, "description": "租赁合同的唯一ID", "schema": {"type": "integer"}}
            ],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaymentCreateInput" }}}
            },
            "responses": {
                "201": {
                    "description": "支付请求已提交，返回支付详情（可能需要后续确认支付状态）。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaymentOutput" }}}
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound", "description": "租赁合同不存在或无效"}
            }
        },
        "get": {
            "tags": ["Payments"],
            "summary": "获取指定合同的支付记录",
            "description": "获取特定租赁合同的所有支付记录。相关方（房东、租客）或管理员可访问。需要认证。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                {"name": "leaseId", "in": "path", "required": true, "description": "租赁合同的唯一ID", "schema": {"type": "integer"}},
                { "name": "page", "in": "query", "description": "页码", "schema": { "type": "integer", "default": 1, "minimum": 1 } },
                { "name": "page_size", "in": "query", "description": "每页数量", "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 100 } }
            ],
            "responses": {
                "200": {
                    "description": "成功获取支付记录列表。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaginatedPaymentOutput" }}}
                },
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/payments/{paymentId}": {
        "get": {
            "tags": ["Payments"],
            "summary": "获取指定支付记录详情",
            "description": "获取特定支付记录的详细信息。相关方或管理员可访问。需要认证。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                {"name": "paymentId", "in": "path", "required": true, "description": "支付记录的唯一ID", "schema": {"type": "integer"}}
            ],
            "responses": {
                "200": {
                    "description": "成功获取支付记录详情。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaymentOutput" }}}
                },
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/messages": {
        "post": {
            "tags": ["Messages"],
            "summary": "发送消息 (租客/房东)",
            "description": "用户（租客或房东）向另一用户发送消息。后端可集成智能代理逻辑，若接收方为房东且消息符合预设规则，则由代理初步应答。需要认证。",
            "security": [{"bearerAuth": []}],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/MessageCreateInput" } } }
            },
            "responses": {
                "201": {
                    "description": "消息发送成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/MessageOutput" } } }
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "404": {"$ref": "#/components/responses/NotFound", "description": "接收用户不存在"}
            }
        },
        "get": {
            "tags": ["Messages"],
            "summary": "获取与指定用户的消息列表 (对话历史)",
            "description": "获取当前用户与另一指定用户的消息对话历史。按时间倒序排列。需要认证。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                {"name": "chat_with_user_id", "in": "query", "required": true, "description": "对话对象的User ID", "schema": {"type": "integer"}},
                { "name": "before_message_id", "in": "query", "description": "获取此消息ID之前的消息 (用于加载更多)", "schema": { "type": "integer" } },
                { "name": "limit", "in": "query", "description": "返回消息数量", "schema": { "type": "integer", "default": 20, "maximum": 100 } }
            ],
            "responses": {
                "200": {
                    "description": "成功获取消息列表。",
                    "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/MessageOutput" } } } }
                },
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "404": {"$ref": "#/components/responses/NotFound", "description": "对话用户不存在"}
            }
        }
    },
    "/messages/unread-count": {
        "get": {
            "tags": ["Messages"],
            "summary": "获取当前用户未读消息总数",
            "description": "获取当前登录用户的未读消息总数。需要认证。",
            "security": [{"bearerAuth": []}],
            "responses": {
                "200": {
                    "description": "成功获取未读消息总数。",
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "unread_count": {"type": "integer"}
                                }
                            }
                        }
                    }
                },
                "401": {"$ref": "#/components/responses/Unauthorized"}
            }
        }
    },
    "/news": {
        "post": {
            "tags": ["News"],
            "summary": "房东发布新闻/消息",
            "description": "房东可以向租客提供有关房屋租赁和维修等相关新闻或消息。需要房东权限。",
            "security": [{"bearerAuth": []}],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewsCreateInput" } } }
            },
            "responses": {
                "201": {
                    "description": "新闻发布成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewsOutput" } } }
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"}
            }
        },
        "get": {
            "tags": ["News"],
            "summary": "获取新闻列表 (对所有用户可见)",
            "description": "公开接口，获取系统发布的新闻列表，按发布时间倒序排列。",
            "parameters": [
                { "name": "page", "in": "query", "description": "页码", "schema": { "type": "integer", "default": 1, "minimum": 1 } },
                { "name": "page_size", "in": "query", "description": "每页数量", "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 100 } }
            ],
            "responses": {
                "200": {
                    "description": "成功获取新闻列表。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaginatedNewsOutput" } } }
                }
            }
        }
    },
    "/news/{newsId}": {
        "get": {
            "tags": ["News"],
            "summary": "获取指定新闻详情",
            "description": "公开接口，获取特定新闻的详细内容。",
            "parameters": [{"name": "newsId", "in": "path", "required": true, "description": "新闻的唯一ID", "schema": {"type": "integer"}}],
            "responses": {
                "200": {
                    "description": "成功获取新闻详情。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewsOutput" } } }
                },
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        },
        "put": {
            "tags": ["News"],
            "summary": "房东修改新闻",
            "description": "房东修改其发布的新闻内容。需要房东权限且只能修改自己的新闻。",
            "security": [{"bearerAuth": []}],
            "parameters": [{"name": "newsId", "in": "path", "required": true, "description": "新闻的唯一ID", "schema": {"type": "integer"}}],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewsUpdateInput" } } }
            },
            "responses": {
                "200": {
                    "description": "新闻修改成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewsOutput" } } }
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        },
        "delete": {
            "tags": ["News"],
            "summary": "房东删除新闻",
            "description": "房东删除其发布的新闻。需要房东权限且只能删除自己的新闻。",
            "security": [{"bearerAuth": []}],
            "parameters": [{"name": "newsId", "in": "path", "required": true, "description": "新闻的唯一ID", "schema": {"type": "integer"}}],
            "responses": {
                "204": {"description": "新闻删除成功。"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/maintenance-requests": {
        "post": {
            "tags": ["Maintenance"],
            "summary": "租客提交维修申请",
            "description": "租客为其租赁的房源提交维修申请。需要租客权限。",
            "security": [{"bearerAuth": []}],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/MaintenanceRequestCreateInput" } } }
            },
            "responses": {
                "201": {
                    "description": "维修申请提交成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/MaintenanceRequestOutput" } } }
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound", "description": "关联的房源或租赁合同不存在"}
            }
        },
        "get": {
            "tags": ["Maintenance"],
            "summary": "获取维修申请列表 (租客/房东/管理员)",
            "description": "租客获取自己的维修申请，房东获取其名下房源的维修申请，管理员获取所有维修申请。根据用户角色自动筛选。需要认证。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                { "name": "property_id", "in": "query", "description": "按房源ID筛选 (房东/管理员)", "schema": { "type": "integer" } },
                { "name": "status", "in": "query", "description": "按维修状态筛选", "schema": { "$ref": "#/components/schemas/MaintenanceStatus" } },
                { "name": "page", "in": "query", "description": "页码", "schema": { "type": "integer", "default": 1, "minimum": 1 } },
                { "name": "page_size", "in": "query", "description": "每页数量", "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 100 } }
            ],
            "responses": {
                "200": {
                    "description": "成功获取维修申请列表。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaginatedMaintenanceRequestOutput"}}}
                },
                "401": {"$ref": "#/components/responses/Unauthorized"}
            }
        }
    },
    "/maintenance-requests/{requestId}": {
        "get": {
            "tags": ["Maintenance"],
            "summary": "获取指定维修申请详情",
            "description": "获取特定维修申请的详细信息。相关方或管理员可访问。需要认证。",
            "security": [{"bearerAuth": []}],
            "parameters": [{"name": "requestId", "in": "path", "required": true, "description": "维修申请的唯一ID", "schema": {"type": "integer"}}],
            "responses": {
                "200": {
                    "description": "成功获取维修申请详情。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/MaintenanceRequestOutput" } } }
                },
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        },
        "put": {
            "tags": ["Maintenance"],
            "summary": "房东/物业处理更新维修申请状态",
            "description": "房东或物业人员更新维修申请的状态（如：处理中、已完成）或指派维修人员。需要房东或管理员权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [{"name": "requestId", "in": "path", "required": true, "description": "维修申请的唯一ID", "schema": {"type": "integer"}}],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/MaintenanceRequestUpdateInput" } } }
            },
            "responses": {
                "200": {
                    "description": "维修申请状态更新成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/MaintenanceRequestOutput" } } }
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/complaints": {
        "post": {
            "tags": ["Complaints"],
            "summary": "租客对房源或服务进行投诉",
            "description": "租客可以对不满意的房源或服务提交投诉。需要租客权限。",
            "security": [{"bearerAuth": []}],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ComplaintCreateInput" } } }
            },
            "responses": {
                "201": {
                    "description": "投诉提交成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ComplaintOutput" } } }
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"}
            }
        },
        "get": {
            "tags": ["Complaints"],
            "summary": "获取投诉列表 (管理员/相关租客)",
            "description": "管理员获取所有投诉列表，租客可以获取自己提交的投诉列表。需要认证。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                { "name": "property_id", "in": "query", "description": "按房源ID筛选 (管理员)", "schema": { "type": "integer" } },
                { "name": "complainant_id", "in": "query", "description": "按投诉人ID筛选 (管理员)", "schema": { "type": "integer" } },
                { "name": "status", "in": "query", "description": "按投诉状态筛选", "schema": { "$ref": "#/components/schemas/ComplaintStatus" } },
                { "name": "page", "in": "query", "description": "页码", "schema": { "type": "integer", "default": 1, "minimum": 1 } },
                { "name": "page_size", "in": "query", "description": "每页数量", "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 100 } }
            ],
            "responses": {
                "200": {
                    "description": "成功获取投诉列表。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaginatedComplaintOutput"}}}
                },
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden", "description": "仅管理员或相关租客可访问"}
            }
        }
    },
    "/complaints/{complaintId}": {
        "get": {
            "tags": ["Complaints"],
            "summary": "获取指定投诉详情",
            "description": "获取特定投诉的详细信息。相关租客或管理员可访问。需要认证。",
            "security": [{"bearerAuth": []}],
            "parameters": [{"name": "complaintId", "in": "path", "required": true, "description": "投诉的唯一ID", "schema": {"type": "integer"}}],
            "responses": {
                "200": {
                    "description": "成功获取投诉详情。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ComplaintOutput" } } }
                },
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        },
        "put": {
            "tags": ["Complaints"],
            "summary": "系统管理员或相关人员处理投诉",
            "description": "系统管理员更新投诉的状态或添加处理备注。需要管理员权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [{"name": "complaintId", "in": "path", "required": true, "description": "投诉的唯一ID", "schema": {"type": "integer"}}],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ComplaintUpdateInput" } } }
            },
            "responses": {
                "200": {
                    "description": "投诉状态更新成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ComplaintOutput" } } }
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/admin/users": {
      "get": {
        "tags": ["Admin - Users"],
        "summary": "【管理员】获取用户列表",
        "description": "系统管理员获取所有用户列表，支持按角色等条件筛选。需要管理员权限。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "username", "in": "query", "description": "按用户名模糊搜索", "schema": { "type": "string" } },
          { "name": "email", "in": "query", "description": "按邮箱搜索", "schema": { "type": "string" } },
          { "name": "role", "in": "query", "description": "按用户角色筛选", "schema": { "$ref": "#/components/schemas/UserRole" } },
          { "name": "is_active", "in": "query", "description": "按用户激活状态筛选", "schema": { "type": "boolean" } },
          { "name": "page", "in": "query", "description": "页码", "schema": { "type": "integer", "default": 1, "minimum": 1 } },
          { "name": "page_size", "in": "query", "description": "每页数量", "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 100 } }
        ],
        "responses": {
          "200": {
            "description": "成功获取用户列表。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaginatedUserOutput" } } }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" }
        }
      }
    },
    "/admin/users/{userId}": {
        "get": {
            "tags": ["Admin - Users"],
            "summary": "【管理员】获取指定用户信息",
            "description": "系统管理员获取特定用户的详细信息。需要管理员权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [{"name": "userId", "in": "path", "required": true, "description": "用户的唯一ID", "schema": {"type": "integer"}}],
            "responses": {
                "200": {
                    "description": "成功获取用户信息。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserOutput" }}}
                },
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        },
        "put": {
            "tags": ["Admin - Users"],
            "summary": "【管理员】更新用户信息或权限",
            "description": "系统管理员更新指定用户的角色、状态（激活/禁用）等信息。需要管理员权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [{"name": "userId", "in": "path", "required": true, "description": "用户的唯一ID", "schema": {"type": "integer"}}],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AdminUserUpdateInput" }}}
            },
            "responses": {
                "200": {
                    "description": "用户信息更新成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserOutput" }}}
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        },
        "delete": {
            "tags": ["Admin - Users"],
            "summary": "【管理员】删除用户",
            "description": "系统管理员删除指定用户账户（通常为逻辑删除）。需要管理员权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [{"name": "userId", "in": "path", "required": true, "description": "用户的唯一ID", "schema": {"type": "integer"}}],
            "responses": {
                "204": {"description": "用户删除成功。"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/admin/properties": {
        "get": {
            "tags": ["Admin - Properties"],
            "summary": "【管理员】获取所有房源列表",
            "description": "系统管理员获取系统内所有房源列表，支持多种筛选条件。需要管理员权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [
                { "name": "landlord_id", "in": "query", "description": "按房东ID筛选", "schema": { "type": "integer" } },
                { "name": "status", "in": "query", "description": "按房源状态筛选", "schema": { "$ref": "#/components/schemas/PropertyStatus" } },
                { "name": "address_keyword", "in": "query", "description": "按地址关键词搜索", "schema": { "type": "string" } },
                { "name": "is_verified", "in": "query", "description": "按是否已核实筛选 (如果系统有核实流程)", "schema": { "type": "boolean" } },
                { "name": "page", "in": "query", "description": "页码", "schema": { "type": "integer", "default": 1, "minimum": 1 } },
                { "name": "page_size", "in": "query", "description": "每页数量", "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 100 } }
            ],
            "responses": {
                "200": {
                    "description": "成功获取房源列表。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaginatedPropertyOutput" } } }
                },
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"}
            }
        }
    },
    "/admin/properties/{propertyId}/verify": {
        "put": {
            "tags": ["Admin - Properties"],
            "summary": "【管理员】审核/管理房源",
            "description": "系统管理员对房源进行审核（如标记为已核实）或进行其他管理操作。需要管理员权限。",
            "security": [{"bearerAuth": []}],
            "parameters": [{"name": "propertyId", "in": "path", "required": true, "description": "房源的唯一ID", "schema": {"type": "integer"}}],
            "requestBody": {
                "required": true,
                "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AdminPropertyUpdateInput" } } }
            },
            "responses": {
                "200": {
                    "description": "房源管理操作成功。",
                    "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PropertyOutput" } } }
                },
                "400": {"$ref": "#/components/responses/BadRequest"},
                "401": {"$ref": "#/components/responses/Unauthorized"},
                "403": {"$ref": "#/components/responses/Forbidden"},
                "404": {"$ref": "#/components/responses/NotFound"}
            }
        }
    },
    "/admin/reports/rental-rate": {
      "get": {
        "tags": ["Admin - Reports"],
        "summary": "【管理员】获取房源出租率统计报表",
        "description": "系统管理员获取房源出租率的统计数据。需要管理员权限。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
            {"name": "start_date", "in": "query", "description": "统计开始日期", "schema": {"type": "string", "format": "date"}},
            {"name": "end_date", "in": "query", "description": "统计结束日期", "schema": {"type": "string", "format": "date"}},
            {"name": "group_by", "in": "query", "description": "分组依据 (e.g., 'month', 'area')", "schema": {"type": "string"}}
        ],
        "responses": {
          "200": {
            "description": "成功获取房源出租率报表。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReportOutput" } } }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" }
        }
      }
    },
    "/admin/reports/income": {
      "get": {
        "tags": ["Admin - Reports"],
        "summary": "【管理员】获取租金收入统计报表",
        "description": "系统管理员获取租金收入的统计数据。需要管理员权限。",
        "security": [{ "bearerAuth": [] }],
         "parameters": [
            {"name": "start_date", "in": "query", "description": "统计开始日期", "schema": {"type": "string", "format": "date"}},
            {"name": "end_date", "in": "query", "description": "统计结束日期", "schema": {"type": "string", "format": "date"}},
            {"name": "group_by", "in": "query", "description": "分组依据 (e.g., 'month', 'property_type')", "schema": {"type": "string"}}
        ],
        "responses": {
          "200": {
            "description": "成功获取租金收入报表。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReportOutput" } } }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" }
        }
      }
    },
    "/admin/reports/user-activity": {
      "get": {
        "tags": ["Admin - Reports"],
        "summary": "【管理员】获取用户活跃度统计报表",
        "description": "系统管理员获取用户活跃度（如新增用户、活跃用户数等）的统计数据。需要管理员权限。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
            {"name": "start_date", "in": "query", "description": "统计开始日期", "schema": {"type": "string", "format": "date"}},
            {"name": "end_date", "in": "query", "description": "统计结束日期", "schema": {"type": "string", "format": "date"}},
            {"name": "activity_type", "in": "query", "description": "活跃度类型 (e.g., 'new_registrations', 'logins')", "schema": {"type": "string"}}
        ],
        "responses": {
          "200": {
            "description": "成功获取用户活跃度报表。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ReportOutput" } } }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" }
        }
      }
    },
    "/admin/system/logs": {
      "get": {
        "tags": ["Admin - System"],
        "summary": "【管理员】查看系统运行日志",
        "description": "系统管理员查看系统运行日志，支持按时间、级别等条件筛选，为系统管理提供决策支持。需要管理员权限。",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
            {"name": "start_datetime", "in": "query", "description": "日志开始时间", "schema": {"type": "string", "format": "date-time"}},
            {"name": "end_datetime", "in": "query", "description": "日志结束时间", "schema": {"type": "string", "format": "date-time"}},
            {"name": "level", "in": "query", "description": "日志级别", "schema": {"$ref": "#/components/schemas/LogLevel"}},
            {"name": "keyword", "in": "query", "description": "日志内容关键词", "schema": {"type": "string"}},
            { "name": "page", "in": "query", "description": "页码", "schema": { "type": "integer", "default": 1, "minimum": 1 } },
            { "name": "page_size", "in": "query", "description": "每页数量", "schema": { "type": "integer", "default": 50, "minimum": 1, "maximum": 200 } }
        ],
        "responses": {
          "200": {
            "description": "成功获取系统日志列表。",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaginatedLogEntryOutput" } } }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "UserRole": {
        "type": "string",
        "enum": ["tenant", "landlord", "admin"],
        "description": "用户角色: tenant (租客), landlord (房东), admin (系统管理员)。"
      },
      "UserRegistrationInput": {
        "type": "object",
        "required": ["username", "password", "email", "phone", "role"],
        "properties": {
          "username": { "type": "string", "minLength": 3, "maxLength": 50, "pattern": "^[a-zA-Z0-9_]+$", "example": "johndoe", "description": "用户名，3-50位，仅限字母、数字、下划线。" },
          "password": { "type": "string", "format": "password", "minLength": 8, "example": "P@sswOrd123!", "description": "密码，至少8位，建议包含大小写字母、数字和特殊字符。" },
          "email": { "type": "string", "format": "email", "example": "johndoe@example.com", "description": "电子邮箱。" },
          "phone": { "type": "string", "pattern": "^\\+?[1-9]\\d{1,14}$", "example": "13800138000", "description": "电话号码，符合E.164标准。" },
          "role": { "$ref": "#/components/schemas/UserRole", "description": "注册时选择的角色，通常为 tenant 或 landlord。" }
        }
      },
      "LoginInput": {
        "type": "object",
        "required": ["username_or_email", "password"],
        "properties": {
          "username_or_email": { "type": "string", "example": "johndoe", "description": "用户名或电子邮箱。" },
          "password": { "type": "string", "format": "password", "example": "P@sswOrd123!", "description": "密码。" }
        }
      },
      "MFAVerifyInput": {
        "type": "object",
        "required": ["otp_code"],
        "properties": {
            "otp_code": { "type": "string", "pattern": "^\\d{6}$", "example": "123456", "description": "用户输入的6位MFA动态验证码。" }
        }
      },
      "MFASetupResponse": {
        "type": "object",
        "properties": {
            "secret_key": {"type": "string", "description": "TOTP密钥，用于用户在Authenticator应用中手动输入。"},
            "qr_code_image_uri": {"type": "string", "format": "uri", "description": "包含TOTP设置信息的二维码图片URI (data URI or URL)。"}
        }
      },
      "AuthResponse": {
        "type": "object",
        "properties": {
          "access_token": { "type": "string", "description": "JWT认证令牌。" },
          "token_type": { "type": "string", "default": "bearer", "example": "bearer" },
          "expires_in": { "type": "integer", "example": 3600, "description": "Token有效期（秒）。" },
          "user": { "$ref": "#/components/schemas/UserOutput", "description": "当前登录用户信息。" },
          "mfa_required": {"type": "boolean", "default": false, "description": "指示是否需要进行MFA验证。如果为true，则access_token可能是临时的，需要通过MFA验证后获取完整权限的token。"}
        }
      },
      "UserOutput": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "readOnly": true, "example": 1, "description": "用户唯一ID。" },
          "username": { "type": "string", "example": "johndoe", "description": "用户名。" },
          "email": { "type": "string", "format": "email", "example": "johndoe@example.com", "description": "电子邮箱。" },
          "phone": { "type": "string", "example": "13800138000", "description": "电话号码。" },
          "role": { "$ref": "#/components/schemas/UserRole", "description": "用户角色。" },
          "is_active": { "type": "boolean", "default": true, "description": "账户是否激活。" },
          "mfa_enabled": { "type": "boolean", "default": false, "description": "是否启用了MFA。" },
          "created_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "账户创建时间。" },
          "updated_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "账户最后更新时间。" },
          "last_login_at": { "type": "string", "format": "date-time", "readOnly": true, "nullable": true, "description": "最后登录时间。" },
          "rental_history_summary": { "type": "string", "nullable": true, "description": "租赁历史摘要（具体实现可为对象或链接）。" }
        }
      },
      "UserUpdateInput": {
        "type": "object",
        "properties": {
          "email": { "type": "string", "format": "email", "description": "新的电子邮箱。" },
          "phone": { "type": "string", "description": "新的电话号码。" },
          "current_password": { "type": "string", "format": "password", "description": "当前密码（用于修改密码或敏感信息时验证）。" },
          "new_password": { "type": "string", "format": "password", "minLength": 8, "description": "新密码（如果需要修改密码）。" },
          "enable_mfa": { "type": "boolean", "description": "启用或禁用MFA。启用时，可能需要先调用MFA设置接口。" }
        }
      },
      "AdminUserUpdateInput": {
        "type": "object",
        "properties": {
            "email": { "type": "string", "format": "email" },
            "phone": { "type": "string" },
            "role": { "$ref": "#/components/schemas/UserRole" },
            "is_active": { "type": "boolean", "description": "设置用户账户是否激活。" },
            "reset_password": { "type": "string", "format": "password", "minLength": 8, "description": "为用户重置的新密码（可选）。" },
            "force_mfa_reset": { "type": "boolean", "description": "强制用户下次登录时重置MFA。" }
        }
      },
      "PropertyType": {
          "type": "string",
          "enum": ["apartment", "house", "studio", "shared_room", "other"],
          "description": "房屋类型: apartment (公寓), house (别墅/独立屋), studio (开间), shared_room (合租单间), other (其他)。"
      },
      "PropertyStatus": {
        "type": "string",
        "enum": ["vacant", "rented", "under_maintenance", "pending_approval", "delisted"],
        "description": "房源状态: vacant (空置), rented (已出租), under_maintenance (维修中), pending_approval (待审核), delisted (已下架)。"
      },
      "PropertyMediaOutput": {
          "type": "object",
          "properties": {
              "id": {"type": "integer", "readOnly": true, "description": "媒体文件唯一ID。"},
              "url": {"type": "string", "format": "url", "description": "媒体文件访问URL。"},
              "thumbnail_url": {"type": "string", "format": "url", "nullable": true, "description": "视频缩略图URL。"},
              "media_type": {"type": "string", "enum": ["image", "video"], "description": "媒体类型。"},
              "description": {"type": "string", "nullable": true, "description": "媒体文件描述。"},
              "uploaded_at": {"type": "string", "format": "date-time", "readOnly": true, "description": "上传时间。"}
          }
      },
      "PropertyCreateInput": {
        "type": "object",
        "required": ["address_line1", "city", "postal_code", "country_code", "property_type", "area_sqm", "rent_price_monthly", "deposit_amount"],
        "properties": {
          "title": { "type": "string", "maxLength": 100, "description": "房源标题，吸引租客。", "example": "近地铁精装两居室，拎包入住" },
          "address_line1": { "type": "string", "description": "详细地址门牌号。", "example": "幸福路123号 幸福小区 1号楼 2单元 301室" },
          "address_line2": { "type": "string", "nullable": true, "description": "地址补充信息。", "example": "A座" },
          "city": { "type": "string", "description": "城市。", "example": "北京市" },
          "district": { "type": "string", "nullable": true, "description": "行政区/县。", "example": "朝阳区" },
          "postal_code": { "type": "string", "description": "邮政编码。", "example": "100010" },
          "country_code": { "type": "string", "pattern": "^[A-Z]{2}$", "description": "国家代码 (ISO 3166-1 alpha-2)。", "example": "CN" },
          "latitude": { "type": "number", "format": "float", "nullable": true, "description": "纬度。", "example": 39.9042 },
          "longitude": { "type": "number", "format": "float", "nullable": true, "description": "经度。", "example": 116.4074 },
          "property_type": { "$ref": "#/components/schemas/PropertyType", "description": "房屋类型。" },
          "area_sqm": { "type": "number", "format": "float", "minimum": 1, "description": "建筑面积 (平方米)。", "example": 85.5 },
          "rent_price_monthly": { "type": "number", "format": "float", "minimum": 0, "description": "月租金。", "example": 5000.00 },
          "deposit_amount": { "type": "number", "format": "float", "minimum": 0, "description": "押金金额。", "example": 10000.00 },
          "bedrooms": { "type": "integer", "minimum": 0, "description": "卧室数量。", "example": 2 },
          "living_rooms": { "type": "integer", "minimum": 0, "description": "客厅数量。", "example": 1 },
          "bathrooms": { "type": "integer", "minimum": 0, "description": "卫生间数量。", "example": 1 },
          "floor_level": { "type": "integer", "nullable": true, "description": "所在楼层。", "example": 3 },
          "total_floors": { "type": "integer", "nullable": true, "description": "总楼层数。", "example": 6 },
          "year_built": { "type": "integer", "nullable": true, "minimum": 1800, "maximum": 2100, "description": "建造年份。", "example": 2010 },
          "description_text": { "type": "string", "maxLength": 5000, "description": "房源详细描述。", "example": "本房源采光好，交通便利..." },
          "furnishing_status": { "type": "string", "nullable": true, "description": "装修情况 (如：精装修、简装、毛坯)。", "example": "精装修" },
          "amenities": { "type": "array", "items": { "type": "string" }, "nullable": true, "description": "房屋设施列表 (如：空调、洗衣机、WIFI)。", "example": ["空调", "洗衣机", "冰箱", "WIFI"] },
          "rules": { "type": "array", "items": { "type": "string" }, "nullable": true, "description": "租赁规则 (如：可养宠物、禁止吸烟)。", "example": ["禁止吸烟", "可协商养小型宠物"] },
          "available_date": { "type": "string", "format": "date", "description": "可入住日期。", "example": "2025-06-01" },
          "images": { "type": "array", "items": { "type": "string", "format": "binary" }, "description": "房屋照片文件 (通过 multipart/form-data 上传)。" },
          "videos": { "type": "array", "items": { "type": "string", "format": "binary" }, "description": "房屋视频文件 (通过 multipart/form-data 上传)。" }
        }
      },
      "PropertyUpdateInput": {
        "allOf": [ { "$ref": "#/components/schemas/PropertyCreateInput" } ],
        "properties": {
            "status": { "$ref": "#/components/schemas/PropertyStatus", "description": "更新房源状态。" }
        },
        "description": "用于更新房源信息。字段与创建时类似，但图片/视频处理可能不同（例如，提供ID列表以保留或删除现有媒体）。"
      },
      "PropertyStatusUpdateInput": {
          "type": "object",
          "required": ["status"],
          "properties": {
              "status": { "$ref": "#/components/schemas/PropertyStatus" },
              "reason": { "type": "string", "nullable": true, "description": "状态变更原因（例如，维修中原因）。" }
          }
      },
      "PropertyOutput": {
        "allOf": [ { "$ref": "#/components/schemas/PropertyCreateInput" } ],
        "properties": {
          "id": { "type": "integer", "readOnly": true, "example": 101, "description": "房源唯一ID。" },
          "landlord_id": { "type": "integer", "readOnly": true, "example": 12, "description": "房东用户ID。" },
          "landlord_info": { "$ref": "#/components/schemas/UserSummaryOutput", "readOnly": true, "description": "房东简要信息。" },
          "status": { "$ref": "#/components/schemas/PropertyStatus", "description": "当前房源状态。" },
          "is_verified_by_admin": { "type": "boolean", "default": false, "readOnly": true, "description": "是否由管理员核实。" },
          "view_count": { "type": "integer", "default": 0, "readOnly": true, "description": "浏览次数。" },
          "created_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "房源发布时间。" },
          "updated_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "房源最后更新时间。" },
          "media_files": { "type": "array", "items": { "$ref": "#/components/schemas/PropertyMediaOutput" }, "readOnly": true, "description": "房源关联的图片和视频信息列表。" },
          "surrounding_environment_info": {"type": "string", "nullable": true, "description": "周边环境描述，由系统或房东提供。", "example": "靠近XX公园和XX购物中心，生活便利。"}
        },
        "description": "房源详细信息输出模型。"
      },
      "PropertySummaryOutput": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "example": 101 },
          "title": { "type": "string", "example": "近地铁精装两居室" },
          "address_summary": { "type": "string", "example": "北京市朝阳区 幸福路123号" },
          "property_type": { "$ref": "#/components/schemas/PropertyType" },
          "area_sqm": { "type": "number", "format": "float", "example": 85.5 },
          "rent_price_monthly": { "type": "number", "format": "float", "example": 5000.00 },
          "bedrooms": { "type": "integer", "example": 2 },
          "living_rooms": { "type": "integer", "example": 1 },
          "main_image_url": { "type": "string", "format": "url", "nullable": true, "description": "房源主图URL。" },
          "status": { "$ref": "#/components/schemas/PropertyStatus" }
        },
        "description": "房源列表中的摘要信息。"
      },
      "AdminPropertyUpdateInput": {
          "type": "object",
          "properties": {
              "status": { "$ref": "#/components/schemas/PropertyStatus", "description": "管理员设置的房源状态。" },
              "is_verified_by_admin": { "type": "boolean", "description": "设置房源是否已核实。" },
              "admin_notes": { "type": "string", "nullable": true, "description": "管理员备注。" }
          }
      },
      "BookingStatus": {
        "type": "string",
        "enum": ["pending_confirmation", "confirmed_by_landlord", "cancelled_by_tenant", "cancelled_by_landlord", "completed", "expired"],
        "description": "预约状态: pending_confirmation (待房东确认), confirmed_by_landlord (房东已确认), cancelled_by_tenant (租客已取消), cancelled_by_landlord (房东已取消), completed (看房已完成), expired (已过期)。"
      },
      "BookingCreateInput": {
        "type": "object",
        "required": ["property_id", "requested_datetime"],
        "properties": {
          "property_id": { "type": "integer", "description": "预约的房源ID。" },
          "requested_datetime": { "type": "string", "format": "date-time", "description": "期望看房时间 (UTC)。", "example": "2025-06-10T14:30:00Z" },
          "notes_for_landlord": { "type": "string", "maxLength": 500, "nullable": true, "description": "给房东的留言。" }
        }
      },
      "BookingStatusUpdateInput": {
          "type": "object",
          "required": ["status"],
          "properties": {
              "status": { "$ref": "#/components/schemas/BookingStatus" },
              "reason": { "type": "string", "maxLength": 255, "nullable": true, "description": "状态变更原因（如取消原因）。" }
          }
      },
      "BookingOutput": {
        "allOf": [ { "$ref": "#/components/schemas/BookingCreateInput" } ],
        "properties": {
          "id": { "type": "integer", "readOnly": true, "example": 201, "description": "预约唯一ID。" },
          "tenant_id": { "type": "integer", "readOnly": true, "example": 5, "description": "租客用户ID。" },
          "tenant_info": { "$ref": "#/components/schemas/UserSummaryOutput", "readOnly": true, "description": "租客简要信息。" },
          "landlord_id": { "type": "integer", "readOnly": true, "example": 12, "description": "房东用户ID。" },
          "landlord_info": { "$ref": "#/components/schemas/UserSummaryOutput", "readOnly": true, "description": "房东简要信息。" },
          "property_summary": { "$ref": "#/components/schemas/PropertySummaryOutput", "readOnly": true, "description": "预约房源的简要信息。" },
          "status": { "$ref": "#/components/schemas/BookingStatus", "description": "当前预约状态。" },
          "created_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "预约创建时间。" },
          "updated_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "预约最后更新时间。" }
        }
      },
      "LeaseStatus": {
          "type": "string",
          "enum": ["draft", "pending_tenant_signature", "pending_landlord_signature", "active", "expired", "terminated_early", "payment_due"],
          "description": "合同状态: draft (草稿), pending_tenant_signature (待租客签署), pending_landlord_signature (待房东签署), active (生效中), expired (已到期), terminated_early (提前终止), payment_due (租金逾期)。"
      },
      "LeaseCreateInput": {
          "type": "object",
          "required": ["property_id", "tenant_id", "start_date", "end_date", "monthly_rent_amount", "deposit_amount", "payment_due_day_of_month"],
          "properties": {
              "property_id": {"type": "integer", "description": "租赁的房源ID。"},
              "tenant_id": {"type": "integer", "description": "租客用户ID。"},
              "start_date": {"type": "string", "format": "date", "description": "合同开始日期。", "example": "2025-07-01"},
              "end_date": {"type": "string", "format": "date", "description": "合同结束日期。", "example": "2026-06-30"},
              "monthly_rent_amount": {"type": "number", "format": "float", "minimum": 0, "description": "月租金金额。", "example": 5000.00},
              "deposit_amount": {"type": "number", "format": "float", "minimum": 0, "description": "押金金额。", "example": 10000.00},
              "payment_due_day_of_month": {"type": "integer", "minimum": 1, "maximum": 28, "description": "每月租金支付截止日 (1-28号)。", "example": 5},
              "additional_terms": {"type": "string", "maxLength": 10000, "nullable": true, "description": "附加条款内容 (可以是Markdown或纯文本)。"}
          }
      },
      "LeaseUpdateInput": {
          "type": "object",
          "properties": {
              "status": { "$ref": "#/components/schemas/LeaseStatus", "description": "更新合同状态 (通常由系统或管理员操作)。" },
              "additional_terms": {"type": "string", "maxLength": 10000, "nullable": true, "description": "修改附加条款 (在特定状态下允许)。"},
              "termination_date": {"type": "string", "format": "date", "nullable": true, "description": "提前终止日期 (如果适用)。"},
              "termination_reason": {"type": "string", "nullable": true, "description": "提前终止原因 (如果适用)。"}
          }
      },
      "LeaseSignInput": {
          "type": "object",
          "required": ["signature_data"],
          "properties": {
              "signature_data": {"type": "string", "description": "签署确认信息 (例如，用户确认已阅读并同意的标记，或更复杂的电子签名数据)。", "example": "UserConfirmedAgreement_Timestamp"}
          }
      },
      "LeaseOutput": {
          "allOf": [{"$ref": "#/components/schemas/LeaseCreateInput"}],
          "properties": {
              "id": {"type": "integer", "readOnly": true, "example": 301, "description": "租赁合同唯一ID。"},
              "landlord_id": {"type": "integer", "readOnly": true, "description": "房东用户ID。"},
              "landlord_info": { "$ref": "#/components/schemas/UserSummaryOutput", "readOnly": true, "description": "房东简要信息。" },
              "tenant_info": { "$ref": "#/components/schemas/UserSummaryOutput", "readOnly": true, "description": "租客简要信息。" },
              "property_summary": { "$ref": "#/components/schemas/PropertySummaryOutput", "readOnly": true, "description": "租赁房源的简要信息。" },
              "status": {"$ref": "#/components/schemas/LeaseStatus", "description": "当前合同状态。"},
              "tenant_signed_at": {"type": "string", "format": "date-time", "nullable": true, "readOnly": true, "description": "租客签署时间。"},
              "landlord_signed_at": {"type": "string", "format": "date-time", "nullable": true, "readOnly": true, "description": "房东签署时间。"},
              "contract_document_url": {"type": "string", "format": "url", "nullable": true, "readOnly": true, "description": "生成的电子合同PDF文件访问URL。"},
              "created_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "合同创建时间。" },
              "updated_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "合同最后更新时间。" }
          }
      },
      "PaymentMethod": {
          "type": "string",
          "enum": ["wechat_pay", "alipay", "credit_card", "bank_transfer"],
          "description": "支付方式: wechat_pay (微信支付), alipay (支付宝), credit_card (信用卡), bank_transfer (银行转账)。"
      },
      "PaymentStatus": {
          "type": "string",
          "enum": ["pending", "successful", "failed", "refunded", "processing"],
          "description": "支付状态: pending (待支付), successful (支付成功), failed (支付失败), refunded (已退款), processing (处理中)。"
      },
      "PaymentCreateInput": {
          "type": "object",
          "required": ["amount", "payment_method"],
          "properties": {
              "amount": {"type": "number", "format": "float", "minimum": 0.01, "description": "支付金额。", "example": 5000.00},
              "payment_method": {"$ref": "#/components/schemas/PaymentMethod", "description": "选择的支付方式。"},
              "description": {"type": "string", "maxLength": 255, "nullable": true, "description": "支付描述，如“2025年7月租金”。", "example": "2025年7月租金"},
              "payment_gateway_payload": {"type": "object", "nullable": true, "description": "传递给支付网关的特定参数 (如预支付ID等)。"}
          }
      },
      "PaymentOutput": {
          "allOf": [{"$ref": "#/components/schemas/PaymentCreateInput"}],
          "properties": {
              "id": {"type": "integer", "readOnly": true, "example": 401, "description": "支付记录唯一ID。"},
              "lease_id": {"type": "integer", "readOnly": true, "description": "关联的租赁合同ID。"},
              "tenant_id": {"type": "integer", "readOnly": true, "description": "支付方（租客）用户ID。"},
              "status": {"$ref": "#/components/schemas/PaymentStatus", "description": "当前支付状态。"},
              "transaction_id": {"type": "string", "nullable": true, "readOnly": true, "description": "支付网关生成的交易流水号。"},
              "paid_at": {"type": "string", "format": "date-time", "nullable": true, "readOnly": true, "description": "支付成功时间。"},
              "created_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "支付记录创建时间。" },
              "updated_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "支付记录最后更新时间。" }
          }
      },
      "MessageCreateInput": {
          "type": "object",
          "required": ["receiver_id", "content"],
          "properties": {
              "receiver_id": {"type": "integer", "description": "消息接收方用户ID。"},
              "content": {"type": "string", "maxLength": 2000, "description": "消息内容。"}
          }
      },
      "MessageOutput": {
          "allOf": [{"$ref": "#/components/schemas/MessageCreateInput"}],
          "properties": {
              "id": {"type": "integer", "readOnly": true, "example": 501, "description": "消息唯一ID。"},
              "sender_id": {"type": "integer", "readOnly": true, "description": "消息发送方用户ID。"},
              "sent_at": {"type": "string", "format": "date-time", "readOnly": true, "description": "消息发送时间。"},
              "is_read_by_receiver": {"type": "boolean", "default": false, "readOnly": true, "description": "接收方是否已读。"},
              "is_agent_reply": {"type": "boolean", "default": false, "readOnly": true, "description": "是否为智能代理回复。"}
          }
      },
      "NewsCategory": {
          "type": "string",
          "enum": ["rental_guide", "maintenance_tips", "policy_update", "community_event", "other"],
          "description": "新闻分类: rental_guide (租赁指南), maintenance_tips (维修技巧), policy_update (政策更新), community_event (社区活动), other (其他)。"
      },
      "NewsCreateInput": {
          "type": "object",
          "required": ["title", "content"],
          "properties": {
              "title": {"type": "string", "maxLength": 200, "description": "新闻标题。", "example": "夏季房屋保养小贴士"},
              "content": {"type": "string", "maxLength": 20000, "description": "新闻正文内容 (可以是HTML或Markdown)。"},
              "category": {"$ref": "#/components/schemas/NewsCategory", "nullable": true, "description": "新闻分类。"},
              "cover_image_url": {"type": "string", "format": "url", "nullable": true, "description": "新闻封面图片URL。"}
          }
      },
      "NewsUpdateInput": {
          "allOf": [{"$ref": "#/components/schemas/NewsCreateInput"}]
      },
      "NewsOutput": {
          "allOf": [{"$ref": "#/components/schemas/NewsCreateInput"}],
          "properties": {
              "id": {"type": "integer", "readOnly": true, "example": 601, "description": "新闻唯一ID。"},
              "author_id": {"type": "integer", "readOnly": true, "description": "作者（房东或管理员）用户ID。"},
              "author_info": { "$ref": "#/components/schemas/UserSummaryOutput", "readOnly": true, "description": "作者简要信息。" },
              "is_published": {"type": "boolean", "default": true, "description": "是否已发布。"},
              "published_at": {"type": "string", "format": "date-time", "nullable": true, "readOnly": true, "description": "发布时间。"},
              "created_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "创建时间。" },
              "updated_at": { "type": "string", "format": "date-time", "readOnly": true, "description": "最后更新时间。" }
          }
      },
      "MaintenanceStatus": {
          "type": "string",
          "enum": ["pending_assignment", "assigned_to_worker", "in_progress", "completed", "cancelled_by_tenant", "closed_by_landlord"],
          "description": "维修状态: pending_assignment (待指派), assigned_to_worker (已指派维修工), in_progress (处理中), completed (已完成), cancelled_by_tenant (租客已取消), closed_by_landlord (房东已关闭)。"
      },
      "MaintenanceRequestCreateInput": {
          "type": "object",
          "required": ["property_id", "description"],
          "properties": {
              "property_id": {"type": "integer", "description": "需要维修的房源ID。"},
              "lease_id": {"type": "integer", "nullable": true, "description": "关联的租赁合同ID (如果有)。"},
              "description": {"type": "string", "maxLength": 2000, "description": "维修问题描述。", "example": "卫生间水龙头漏水严重。"},
              "preferred_contact_time": {"type": "string", "nullable": true, "description": "期望联系时间。", "example": "工作日下午"}
          }
      },
      "MaintenanceRequestUpdateInput": {
          "type": "object",
          "properties": {
              "status": {"$ref": "#/components/schemas/MaintenanceStatus", "description": "更新维修状态。"},
              "assigned_worker_name": {"type": "string", "maxLength": 100, "nullable": true, "description": "指派的维修人员姓名。"},
              "worker_contact_info": {"type": "string", "maxLength": 100, "nullable": true, "description": "维修人员联系方式。"},
              "resolution_notes": {"type": "string", "maxLength": 2000, "nullable": true, "description": "维修完成后的处理结果说明。"}
          }
      },
      "MaintenanceRequestOutput": {
          "allOf": [{"$ref": "#/components/schemas/MaintenanceRequestCreateInput"}],
          "properties": {
              "id": {"type": "integer", "readOnly": true, "example": 701, "description": "维修申请唯一ID。"},
              "tenant_id": {"type": "integer", "readOnly": true, "description": "提交申请的租客用户ID。"},
              "tenant_info": { "$ref": "#/components/schemas/UserSummaryOutput", "readOnly": true, "description": "租客简要信息。" },
              "landlord_id": {"type": "integer", "readOnly": true, "description": "房源所属房东用户ID。"},
              "property_summary": { "$ref": "#/components/schemas/PropertySummaryOutput", "readOnly": true, "description": "维修房源的简要信息。" },
              "status": {"$ref": "#/components/schemas/MaintenanceStatus", "description": "当前维修状态。"},
              "submitted_at": {"type": "string", "format": "date-time", "readOnly": true, "description": "申请提交时间。"},
              "updated_at": {"type": "string", "format": "date-time", "readOnly": true, "description": "申请最后更新时间。"},
              "completed_at": {"type": "string", "format": "date-time", "nullable": true, "readOnly": true, "description": "维修完成时间。"}
          }
      },
      "ComplaintType": {
          "type": "string",
          "enum": ["property_condition", "landlord_service", "neighbor_issue", "system_bug", "other"],
          "description": "投诉类型: property_condition (房源状况), landlord_service (房东服务), neighbor_issue (邻里问题), system_bug (系统缺陷), other (其他)。"
      },
      "ComplaintStatus": {
          "type": "string",
          "enum": ["open", "under_review", "in_progress", "resolved", "closed_unresolved"],
          "description": "投诉状态: open (已提交), under_review (审核中), in_progress (处理中), resolved (已解决), closed_unresolved (未解决已关闭)。"
      },
      "ComplaintCreateInput": {
          "type": "object",
          "required": ["complaint_type", "description"],
          "properties": {
              "property_id": {"type": "integer", "nullable": true, "description": "关联的房源ID (如果投诉与特定房源相关)。"},
              "lease_id": {"type": "integer", "nullable": true, "description": "关联的租赁合同ID (如果适用)。"},
              "complaint_type": {"$ref": "#/components/schemas/ComplaintType", "description": "投诉类型。"},
              "subject": {"type": "string", "maxLength": 200, "nullable": true, "description": "投诉主题/简述。", "example": "房东未按约定维修"},
              "description": {"type": "string", "maxLength": 2000, "description": "详细投诉内容。", "example": "之前约定的卫生间漏水问题，房东至今未派人维修..."}
          }
      },
      "ComplaintUpdateInput": {
          "type": "object",
          "properties": {
              "status": {"$ref": "#/components/schemas/ComplaintStatus", "description": "【管理员】更新投诉状态。"},
              "resolution_notes": {"type": "string", "maxLength": 2000, "nullable": true, "description": "【管理员】处理结果或备注说明。"}
          }
      },
      "ComplaintOutput": {
          "allOf": [{"$ref": "#/components/schemas/ComplaintCreateInput"}],
          "properties": {
              "id": {"type": "integer", "readOnly": true, "example": 801, "description": "投诉唯一ID。"},
              "complainant_id": {"type": "integer", "readOnly": true, "description": "投诉人（租客）用户ID。"},
              "complainant_info": { "$ref": "#/components/schemas/UserSummaryOutput", "readOnly": true, "description": "投诉人简要信息。" },
              "status": {"$ref": "#/components/schemas/ComplaintStatus", "description": "当前投诉状态。"},
              "handled_by_admin_id": {"type": "integer", "nullable": true, "readOnly": true, "description": "处理该投诉的管理员用户ID。"},
              "admin_handler_info": { "$ref": "#/components/schemas/UserSummaryOutput", "nullable": true, "readOnly": true, "description": "处理管理员简要信息。" },
              "submitted_at": {"type": "string", "format": "date-time", "readOnly": true, "description": "投诉提交时间。"},
              "updated_at": {"type": "string", "format": "date-time", "readOnly": true, "description": "投诉最后更新时间。"},
              "resolved_at": {"type": "string", "format": "date-time", "nullable": true, "readOnly": true, "description": "投诉解决时间。"}
          }
      },
      "ReportOutput": {
        "type": "object",
        "description": "通用统计报表数据结构。",
        "properties": {
          "report_name": { "type": "string", "description": "报表名称。", "example": "月度租金收入统计" },
          "generated_at": { "type": "string", "format": "date-time", "description": "报表生成时间。" },
          "parameters": { "type": "object", "additionalProperties": true, "description": "生成此报表所用的参数。" },
          "summary_metrics": {
              "type": "object",
              "additionalProperties": { "type": "number", "format": "float" },
              "description": "关键汇总指标，例如总收入、总出租数等。",
              "example": { "total_income": 150000.00, "total_rented_units": 30 }
          },
          "data_series": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "series_name": { "type": "string", "description": "数据系列名称 (例如，按区域、按月份)。" },
                "data_points": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "label": { "type": "string", "description": "数据点标签 (例如，具体月份、具体区域名)。" },
                      "value": { "type": "number", "format": "float", "description": "数据点的值。" }
                    }
                  }
                }
              }
            },
            "description": "详细数据系列，用于图表展示。"
          }
        }
      },
      "LogLevel": {
          "type": "string",
          "enum": ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"],
          "description": "日志级别。"
      },
      "LogEntryOutput": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid", "readOnly": true, "description": "日志条目唯一ID。" },
          "timestamp": { "type": "string", "format": "date-time", "readOnly": true, "description": "日志记录时间。" },
          "level": { "$ref": "#/components/schemas/LogLevel", "readOnly": true, "description": "日志级别。" },
          "message": { "type": "string", "readOnly": true, "description": "日志消息内容。" },
          "user_id": { "type": "integer", "nullable": true, "readOnly": true, "description": "关联的用户ID (如果适用)。" },
          "source_module": { "type": "string", "nullable": true, "readOnly": true, "description": "日志来源模块 (如 'auth', 'properties')。" },
          "ip_address": { "type": "string", "format": "ip", "nullable": true, "readOnly": true, "description": "请求来源IP地址。" },
          "request_details": { "type": "object", "additionalProperties": true, "nullable": true, "readOnly": true, "description": "相关的请求信息摘要。" }
        }
      },
      "UserSummaryOutput": {
          "type": "object",
          "properties": {
              "id": {"type": "integer"},
              "username": {"type": "string"},
              "role": {"$ref": "#/components/schemas/UserRole"}
          },
          "description": "用户简要信息，用于在其他DTO中引用。"
      },
      "ErrorResponse": {
        "type": "object",
        "required": ["code", "message"],
        "properties": {
          "timestamp": { "type": "string", "format": "date-time", "description": "错误发生时间。" },
          "path": { "type": "string", "description": "发生错误的请求路径。" },
          "status_code": { "type": "integer", "description": "HTTP状态码。" },
          "error_code": { "type": "string", "description": "内部定义的错误码，便于追踪。", "example": "VALIDATION_ERROR" },
          "message": { "type": "string", "description": "对用户友好的错误信息。", "example": "输入参数无效。" },
          "details": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "field": {"type": "string", "description": "校验失败的字段名 (如果适用)。"},
                    "issue": {"type": "string", "description": "具体的校验问题。"}
                }
            },
            "nullable": true,
            "description": "详细错误信息列表，例如字段校验失败详情。"
          }
        }
      },
      "PaginationLinks": {
          "type": "object",
          "properties": {
              "first": {"type": "string", "format": "uri", "nullable": true, "description": "第一页链接。"},
              "last": {"type": "string", "format": "uri", "nullable": true, "description": "最后一页链接。"},
              "prev": {"type": "string", "format": "uri", "nullable": true, "description": "上一页链接。"},
              "next": {"type": "string", "format": "uri", "nullable": true, "description": "下一页链接。"}
          }
      },
      "PaginationMeta": {
          "type": "object",
          "properties": {
              "current_page": {"type": "integer", "description": "当前页码。"},
              "from": {"type": "integer", "nullable": true, "description": "当前页第一条数据是总的第几条。"},
              "last_page": {"type": "integer", "description": "最后一页页码。"},
              "path": {"type": "string", "format": "uri", "description": "当前请求的基础路径。"},
              "per_page": {"type": "integer", "description": "每页数量。"},
              "to": {"type": "integer", "nullable": true, "description": "当前页最后一条数据是总的第几条。"},
              "total": {"type": "integer", "description": "总记录数。"}
          }
      },
      "PaginatedPropertySummaryOutput": {
          "type": "object",
          "properties": {
              "data": { "type": "array", "items": { "$ref": "#/components/schemas/PropertySummaryOutput" } },
              "links": { "$ref": "#/components/schemas/PaginationLinks" },
              "meta": { "$ref": "#/components/schemas/PaginationMeta" }
          }
      },
       "PaginatedPropertyOutput": {
          "type": "object",
          "properties": {
              "data": { "type": "array", "items": { "$ref": "#/components/schemas/PropertyOutput" } },
              "links": { "$ref": "#/components/schemas/PaginationLinks" },
              "meta": { "$ref": "#/components/schemas/PaginationMeta" }
          }
      },
      "PaginatedBookingOutput": {
          "type": "object",
          "properties": {
              "data": { "type": "array", "items": { "$ref": "#/components/schemas/BookingOutput" } },
              "links": { "$ref": "#/components/schemas/PaginationLinks" },
              "meta": { "$ref": "#/components/schemas/PaginationMeta" }
          }
      },
      "PaginatedLeaseOutput": {
          "type": "object",
          "properties": {
              "data": { "type": "array", "items": { "$ref": "#/components/schemas/LeaseOutput" } },
              "links": { "$ref": "#/components/schemas/PaginationLinks" },
              "meta": { "$ref": "#/components/schemas/PaginationMeta" }
          }
      },
      "PaginatedPaymentOutput": {
          "type": "object",
          "properties": {
              "data": { "type": "array", "items": { "$ref": "#/components/schemas/PaymentOutput" } },
              "links": { "$ref": "#/components/schemas/PaginationLinks" },
              "meta": { "$ref": "#/components/schemas/PaginationMeta" }
          }
      },
      "PaginatedNewsOutput": {
          "type": "object",
          "properties": {
              "data": { "type": "array", "items": { "$ref": "#/components/schemas/NewsOutput" } },
              "links": { "$ref": "#/components/schemas/PaginationLinks" },
              "meta": { "$ref": "#/components/schemas/PaginationMeta" }
          }
      },
      "PaginatedMaintenanceRequestOutput": {
          "type": "object",
          "properties": {
              "data": { "type": "array", "items": { "$ref": "#/components/schemas/MaintenanceRequestOutput" } },
              "links": { "$ref": "#/components/schemas/PaginationLinks" },
              "meta": { "$ref": "#/components/schemas/PaginationMeta" }
          }
      },
      "PaginatedComplaintOutput": {
          "type": "object",
          "properties": {
              "data": { "type": "array", "items": { "$ref": "#/components/schemas/ComplaintOutput" } },
              "links": { "$ref": "#/components/schemas/PaginationLinks" },
              "meta": { "$ref": "#/components/schemas/PaginationMeta" }
          }
      },
      "PaginatedUserOutput": {
          "type": "object",
          "properties": {
              "data": { "type": "array", "items": { "$ref": "#/components/schemas/UserOutput" } },
              "links": { "$ref": "#/components/schemas/PaginationLinks" },
              "meta": { "$ref": "#/components/schemas/PaginationMeta" }
          }
      },
      "PaginatedLogEntryOutput": {
          "type": "object",
          "properties": {
              "data": { "type": "array", "items": { "$ref": "#/components/schemas/LogEntryOutput" } },
              "links": { "$ref": "#/components/schemas/PaginationLinks" },
              "meta": { "$ref": "#/components/schemas/PaginationMeta" }
          }
      }
    },
    "responses": {
      "BadRequest": {
        "description": "请求无效或参数错误 (HTTP 400)。通常由于客户端发送的数据不符合API预期，例如缺少必填字段、数据格式错误等。",
        "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
      },
      "Unauthorized": {
        "description": "未经授权 (HTTP 401)。客户端未提供有效的认证凭证，或凭证已过期/无效。",
        "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } },
        "headers": {
            "WWW-Authenticate": {
                "schema": {"type": "string"},
                "description": "指示认证方案，例如 'Bearer realm=\"example\"'."
            }
        }
      },
      "Forbidden": {
        "description": "禁止访问 (HTTP 403)。客户端已认证，但无权访问请求的资源。",
        "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
      },
      "NotFound": {
        "description": "请求的资源未找到 (HTTP 404)。服务器无法找到请求的URI对应的资源。",
        "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
      },
      "Conflict": {
        "description": "资源冲突 (HTTP 409)。请求与当前资源状态冲突，例如尝试创建已存在的唯一资源（如用户名）。",
        "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
      },
      "UnprocessableEntity": {
        "description": "无法处理的实体 (HTTP 422)。请求格式正确，但由于语义错误导致服务器无法处理。通常用于更详细的验证错误反馈。",
        "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
      },
      "InternalServerError": {
        "description": "服务器内部错误 (HTTP 500)。服务器在处理请求时遇到意外情况。",
        "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "使用JWT (JSON Web Token) 进行API认证。在请求的`Authorization`头中传递Token，格式为: `Bearer {your_jwt_token}`。"
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ]
}
